<!DOCTYPE html>
<html>

<head>
    <link href="bootstrap.min.css" rel="stylesheet">
    <link href="main.css" rel="stylesheet">
    <!-- Add icon library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta charset="utf-8">

    <title>Remove Cadets</title>
</head>

<body>

    <div class="alert alert-danger d-flex align-items-center" role="alert">
        Cadet's Data will be removed permanently.
    </div>

    <input type="number" class="form-control m-3" id="batch" placeholder="Batch No.">
    <button class="btn btn-outline-primary m-4" id="delete-button">Delete batch</button>

    <script type="module">

        // Import the functions you need from the SDKs you need

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.4/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.9.4/firebase-analytics.js";
        import { getDatabase, ref, set, get, child, onValue, push, update, remove } from "https://www.gstatic.com/firebasejs/9.9.4/firebase-database.js";

        // TODO: Add SDKs for Firebase products that you want to use

        // https://firebase.google.com/docs/web/setup#available-libraries


        // Your web app's Firebase configuration

        // For Firebase JS SDK v7.20.0 and later, measurementId is optional

        const firebaseConfig = {

            apiKey: "AIzaSyDg4s787iggM3YUxvnrdDpkh1f_4fEpWPs",

            authDomain: "canteenvending-d71be.firebaseapp.com",

            databaseURL: "https://canteenvending-d71be-default-rtdb.asia-southeast1.firebasedatabase.app",

            projectId: "canteenvending-d71be",

            storageBucket: "canteenvending-d71be.appspot.com",

            messagingSenderId: "740003631148",

            appId: "1:740003631148:web:23af73b4d0fae2c0e58189",

            measurementId: "G-7GTCJS68QL",

            databaseURL: "https://canteenvending-d71be-default-rtdb.asia-southeast1.firebasedatabase.app/",

        };


        // Initialize Firebase

        const app = initializeApp(firebaseConfig);

        const analytics = getAnalytics(app);

        const dataBase = getDatabase(app);

        // Login Check
        window.onload = function () {
            if (sessionStorage.getItem["admin"] != null) {
                window.location.href = "index.html";
            }
        }

        const button = document.getElementById("delete-button");
        const batch = document.getElementById("batch");

        button.addEventListener("click", () => {
            const batchNo = batch.value;
            console.log('clicked');
            get(child(ref(dataBase), 'cadets/')).then((snapshot) => {
                if (snapshot.exists()) {

                    var cadets = snapshot.val();

                    for (var cadet in cadets) {
                        if (cadets[cadet]['batch'] == batchNo) {
                            remove(ref(dataBase, 'cadets/' + cadet));
                        }
                    }

                    alert("Batch deleted");
                } else {
                    alert("Failed");
                }
            }).catch((error) => {
                console.error(error);
            });
        });
    </script>

    <!-- code ends here -->
</body>

</html>